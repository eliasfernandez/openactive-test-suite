[< Return to Summary](summary.md) | File Generated: Fri Jul 22 2022 10:47:36 GMT+0000 (Coordinated Universal Time)

# prepayment-required >> opportunity-paid (OpenBookingApprovalFlow >> ScheduledSession)

**Booking Flow:** OpenBookingApprovalFlow

**Opportunity Type:** ScheduledSession

**Feature:** Payment / prepayment required (Implemented) 

**Test:**  Successful booking with payment property

A successful end to end booking with the `payment` property included. If features `prepayment-optional` or `prepayment-unavailable` have been implemented then `openBookingPrepayment` in `totalPaymentDue` should be `https://openactive.io/Required` in this test, otherwise it should not be included in the `totalPaymentDue` (as it is required by default).

### Running only this test

```bash
npm start -- --runInBand test/features/payment/prepayment-required/implemented/opportunity-paid-test.js
```

---

‚ö†Ô∏è 20 passed with 0 failures, 157 warnings and 56 suggestions 

---


## Fetch Opportunities

### Local Microservice Test Interface for OrderItem 0 Request
POST http://localhost:3000/test-interface/datasets/uat-ci/opportunities

```json
{
  "@type": "ScheduledSession",
  "superEvent": {
    "@type": "SessionSeries",
    "organizer": {
      "@type": "Organization",
      "@id": "https://localhost:5001/api/identifiers/sellers/1"
    }
  },
  "@context": [
    "https://openactive.io/",
    "https://openactive.io/test-interface"
  ],
  "test:testOpportunityCriteria": "https://openactive.io/test-interface#TestOpportunityBookableNonFreePrepaymentRequired",
  "test:testOpenBookingFlow": "https://openactive.io/test-interface#OpenBookingApprovalFlow",
  "test:testOpportunityDataShapeExpression": [
    {
      "@type": "test:TripleConstraint",
      "predicate": "https://schema.org/remainingAttendeeCapacity",
      "valueExpr": {
        "@type": "NumericNodeConstraint",
        "mininclusive": 2
      }
    },
    {
      "@type": "test:TripleConstraint",
      "predicate": "https://openactive.io/isOpenBookingAllowed",
      "valueExpr": {
        "@type": "test:BooleanNodeConstraint",
        "value": true
      }
    },
    {
      "@type": "test:TripleConstraint",
      "predicate": "https://schema.org/startDate",
      "valueExpr": {
        "@type": "test:DateRangeNodeConstraint",
        "minDate": "2022-07-22T12:27:31.494+00:00"
      }
    },
    {
      "@type": "test:TripleConstraint",
      "predicate": "https://schema.org/eventStatus",
      "valueExpr": {
        "@type": "test:OptionNodeConstraint",
        "datatype": "schema:EventStatusType",
        "blocklist": [
          "https://schema.org/EventCancelled",
          "https://schema.org/EventPostponed"
        ]
      }
    }
  ],
  "test:testOfferDataShapeExpression": [
    {
      "@type": "test:TripleConstraint",
      "predicate": "https://openactive.io/openBookingFlowRequirement",
      "valueExpr": {
        "@type": "test:ArrayConstraint",
        "datatype": "oa:OpenBookingFlowRequirement",
        "includesAll": [
          "https://openactive.io/OpenBookingApproval"
        ],
        "excludesAll": [
          "https://openactive.io/OpenBookingAttendeeDetails",
          "https://openactive.io/OpenBookingIntakeForm"
        ]
      }
    },
    {
      "@type": "test:TripleConstraint",
      "predicate": "https://schema.org/price",
      "valueExpr": {
        "@type": "NumericNodeConstraint",
        "mininclusive": 0.01
      }
    },
    {
      "@type": "test:TripleConstraint",
      "predicate": "https://openactive.io/openBookingPrepayment",
      "valueExpr": {
        "@type": "test:OptionNodeConstraint",
        "datatype": "oa:RequiredStatusType",
        "allowlist": [
          "https://openactive.io/Required"
        ],
        "allowNull": true
      }
    },
    {
      "@type": "test:TripleConstraint",
      "predicate": "https://openactive.io/validFromBeforeStartDate",
      "valueExpr": {
        "@type": "test:DateRangeNodeConstraint",
        "maxDate": "2022-07-22T10:27:31.494+00:00",
        "allowNull": true
      }
    },
    {
      "@type": "test:TripleConstraint",
      "predicate": "https://openactive.io/openBookingInAdvance",
      "valueExpr": {
        "@type": "test:OptionNodeConstraint",
        "datatype": "oa:RequiredStatusType",
        "blocklist": [
          "https://openactive.io/Unavailable"
        ]
      }
    }
  ]
}
```

---
Response status code: 200 OK. Responded in 8.283873ms.
```json
{
  "@context": "https://openactive.io/",
  "@type": "ScheduledSession",
  "@id": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332"
}
```

### Opportunity Feed extract for OrderItem 0 Request
GET http://localhost:3000/opportunity/https%3A%2F%2Flocalhost%3A5001%2Fapi%2Fidentifiers%2Fscheduled-sessions%2F1034%2Fevents%2F10332?useCacheIfAvailable=true


---
Response status code: 200 OK. Responded in 7.61186ms.
```json
{
  "data": {
    "@context": [
      "https://openactive.io/",
      "https://openactive.io/ns-beta"
    ],
    "@type": "ScheduledSession",
    "@id": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332",
    "startDate": "2022-08-01T07:24:11+00:00",
    "endDate": "2022-08-01T10:23:11+00:00",
    "superEvent": {
      "@type": "SessionSeries",
      "@id": "https://localhost:5001/api/identifiers/session-series/1034",
      "name": "Metal Zumba",
      "activity": [
        {
          "@type": "Concept",
          "@id": "https://openactive.io/activity-list#c07d63a0-8eb9-4602-8bcc-23be6deb8f83",
          "inScheme": "https://openactive.io/activity-list",
          "prefLabel": "Jet Skiing"
        }
      ],
      "eventAttendanceMode": "https://schema.org/OnlineEventAttendanceMode",
      "offers": [
        {
          "@type": "Offer",
          "@id": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
          "allowCustomerCancellationFullRefund": false,
          "openBookingFlowRequirement": [
            "https://openactive.io/OpenBookingApproval"
          ],
          "price": 11.77,
          "priceCurrency": "GBP"
        }
      ],
      "organizer": {
        "@type": "Organization",
        "@id": "https://localhost:5001/api/identifiers/sellers/1",
        "name": "Acme Fitness Ltd",
        "isOpenBookingAllowed": true,
        "taxMode": "https://openactive.io/TaxGross",
        "termsOfService": [
          {
            "@type": "PrivacyPolicy",
            "name": "Privacy Policy",
            "requiresExplicitConsent": false,
            "url": "https://example.com/privacy.html"
          }
        ]
      },
      "url": "https://www.example.com/a-session-age",
      "beta:affiliatedLocation": {
        "@type": "Place",
        "name": "Fake Pond",
        "address": {
          "@type": "PostalAddress",
          "addressCountry": "GB",
          "addressLocality": "Another town",
          "addressRegion": "Oxfordshire",
          "postalCode": "OX1 1AA",
          "streetAddress": "1 Fake Park"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 0,
          "longitude": 0
        }
      }
    },
    "duration": "PT2H59M",
    "maximumAttendeeCapacity": 3,
    "remainingAttendeeCapacity": 3
  }
}
```
### Specs
* ‚úÖ should return 200 on success for request relevant to OrderItem 0

## Fetch Opportunities >> validation of Opportunity Feed extract for OrderItem 0
### Specs
* ‚úÖ passes validation checks
* ‚úÖ matches the criteria 'TestOpportunityBookableNonFreePrepaymentRequired' required for this test

### Validations
 * ‚ö†Ô∏è $.eventStatus: Recommended property `eventStatus` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.leader: Recommended property `leader` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.url: Recommended property `url` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.superEvent.description: Recommended property `description` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.image: Recommended property `image` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.ageRange: Recommended property `ageRange` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.genderRestriction: Recommended property `genderRestriction` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.leader: Recommended property `leader` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.level: Recommended property `level` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.offers[0].name: Recommended property `name` is missing from `Offer`.
 * ‚ö†Ô∏è $.superEvent.offers[0].ageRestriction: Recommended property `ageRestriction` is missing from `Offer`.
 * ‚ö†Ô∏è $.superEvent.organizer.url: Recommended property `url` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent.organizer.telephone: Recommended property `telephone` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent.organizer.sameAs: Recommended property `sameAs` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].id: Recommended property `@id` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].url: Recommended property `url` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].description: Recommended property `description` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].image: Recommended property `image` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].telephone: Recommended property `telephone` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].openingHoursSpecification: Recommended property `openingHoursSpecification` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].amenityFeature: Recommended property `amenityFeature` is missing from `Place`.
 * üìù $.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `ScheduledSession`.
 * üìù $.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.superEvent.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `SessionSeries`.
 * üìù $.superEvent.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.superEvent.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.superEvent["beta:affiliatedLocation"].geo.latitude: The value of this property should have at least 3 decimal places. Note that this notice will also appear when trailing zeros have been truncated.
 * üìù $.superEvent["beta:affiliatedLocation"].geo.longitude: The value of this property should have at least 3 decimal places. Note that this notice will also appear when trailing zeros have been truncated.

## C1

### C1 Request
PUT https://localhost:5001/api/openbooking/order-quote-templates/58aecb7a-ee2f-4015-9608-a583c76f6aa7

* **Content-Type:** `"application/vnd.openactive.booking+json; version=1"`
* **Authorization:** `"Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IkIwNEY3QjkxREUzQjk0NzhDNjE4MzNGQjI0QUE1Q0RCIiwidHlwIjoiYXQrand0In0.eyJuYmYiOjE2NTg0ODU2NTYsImV4cCI6MTY1ODQ4OTI1NiwiaXNzIjoiaHR0cHM6Ly9sb2NhbGhvc3Q6NTAwMyIsImF1ZCI6Im9wZW5ib29raW5nIiwiY2xpZW50X2lkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwiaHR0cHM6Ly9vcGVuYWN0aXZlLmlvL2NsaWVudElkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwic3ViIjoiMTAwIiwiYXV0aF90aW1lIjoxNjU4NDg1NjU1LCJpZHAiOiJsb2NhbCIsImh0dHBzOi8vb3BlbmFjdGl2ZS5pby9zZWxsZXJJZCI6Imh0dHBzOi8vbG9jYWxob3N0OjUwMDEvYXBpL2lkZW50aWZpZXJzL3NlbGxlcnMvMSIsImp0aSI6IjkxQTNBNUUzMkU1NzZEODEyNkNGMjNCMDNFQkUzMUFBIiwic2lkIjoiMUFEM0IxMEQ5MDA4QkY0NzREMThFRTU2MzZEMDVBREYiLCJpYXQiOjE2NTg0ODU2NTYsInNjb3BlIjpbIm9wZW5pZCIsIm9wZW5hY3RpdmUtb3BlbmJvb2tpbmciLCJvcGVuYWN0aXZlLWlkZW50aXR5Iiwib2ZmbGluZV9hY2Nlc3MiXSwiYW1yIjpbInB3ZCJdfQ.a2EuRMF8HKqvnIK46S7jGAnFYJTLs5usIok3hM1GayeDD5bQGinKSWhljkFFzPUIey5JBLEDu-ncYu-gmWg85CyMyWM9tUvfXdyzUDelvQDh3aKsUQ82RB-flVXtzeTGkWKx57d03Cfzne_1lnhP0C9P6FWsUueTy_yw_4txHVgbA4y7FYcos624uxw0DUDYakjtSHoOQpXsWzzYUp20Ax_cxJC_zvpslDxQBFX3jTSXKDurUmkVGcFDiC-sRZLvRw9A5iAscUsSLbZBLF-oBQJOYFcXXeT2UsdJLx15MUh9_zKZ932UtV3XtWf8F47Dw8uSfvOl41VL7Q-zTfwKKg"`

```json
{
  "@context": "https://openactive.io/",
  "@type": "OrderQuote",
  "brokerRole": "https://openactive.io/AgentBroker",
  "broker": {
    "@type": "Organization",
    "name": "MyFitnessApp",
    "url": "https://myfitnessapp.example.com",
    "description": "A fitness app for all the community",
    "logo": {
      "@type": "ImageObject",
      "url": "http://data.myfitnessapp.org.uk/images/logo.png"
    },
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Alan Peacock Way",
      "addressLocality": "Village East",
      "addressRegion": "Middlesbrough",
      "postalCode": "TS4 3AE",
      "addressCountry": "GB"
    }
  },
  "seller": "https://localhost:5001/api/identifiers/sellers/1",
  "orderedItem": [
    {
      "@type": "OrderItem",
      "position": 0,
      "acceptedOffer": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
      "orderedItem": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332"
    }
  ],
  "payment": {
    "@type": "Payment",
    "name": "AcmeBroker Points",
    "accountId": "SN1593",
    "paymentProviderId": "STRIPE"
  }
}
```

---
Response status code: 200 OK. Responded in 772.323644ms.
```json
{
  "@context": "https://openactive.io/",
  "@type": "OrderQuote",
  "@id": "https://localhost:5001/api/openbooking/order-quotes/58aecb7a-ee2f-4015-9608-a583c76f6aa7",
  "lease": {
    "@type": "Lease",
    "leaseExpires": "2022-07-22T10:52:58+00:00"
  },
  "orderRequiresApproval": true,
  "bookingService": {
    "@type": "BookingService",
    "name": "Acme booking system",
    "termsOfService": [
      {
        "@type": "PrivacyPolicy",
        "name": "Privacy Policy",
        "requiresExplicitConsent": false,
        "url": "https://example.com/privacy.html"
      }
    ],
    "url": "https://example.com"
  },
  "broker": {
    "@type": "Organization",
    "name": "MyFitnessApp",
    "url": "https://myfitnessapp.example.com"
  },
  "brokerRole": "https://openactive.io/AgentBroker",
  "orderedItem": [
    {
      "@type": "OrderItem",
      "acceptedOffer": {
        "@type": "Offer",
        "@id": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
        "allowCustomerCancellationFullRefund": false,
        "price": 11.77,
        "priceCurrency": "GBP"
      },
      "orderedItem": {
        "@type": "ScheduledSession",
        "@id": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332",
        "startDate": "2022-08-01T07:24:11+00:00",
        "endDate": "2022-08-01T10:23:11+00:00",
        "superEvent": {
          "@type": "SessionSeries",
          "@id": "https://localhost:5001/api/identifiers/session-series/1034",
          "name": "Metal Zumba",
          "activity": [
            {
              "@type": "Concept",
              "@id": "https://openactive.io/activity-list#6bdea630-ad22-4e58-98a3-bca26ee3f1da",
              "inScheme": "https://openactive.io/activity-list",
              "prefLabel": "Rave Fitness"
            }
          ],
          "location": {
            "@type": "Place",
            "name": "Fake fitness studio",
            "geo": {
              "@type": "GeoCoordinates",
              "latitude": 51.6201,
              "longitude": 0.302396
            }
          },
          "url": "https://example.com/events/1034"
        },
        "maximumAttendeeCapacity": 3,
        "remainingAttendeeCapacity": 3
      },
      "position": 0,
      "unitTaxSpecification": [
        {
          "@type": "TaxChargeSpecification",
          "name": "VAT at 20%",
          "price": 2.354,
          "priceCurrency": "GBP",
          "rate": 0.2
        }
      ]
    }
  ],
  "payment": {
    "@type": "Payment",
    "name": "AcmeBroker Points",
    "accountId": "SN1593",
    "paymentProviderId": "STRIPE"
  },
  "seller": {
    "@type": "Organization",
    "@id": "https://localhost:5001/api/identifiers/sellers/1",
    "name": "Acme Fitness Ltd",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "GB",
      "addressLocality": "Another town",
      "addressRegion": "Oxfordshire",
      "postalCode": "OX1 1AA",
      "streetAddress": "1 Hidden Gem"
    },
    "isOpenBookingAllowed": true,
    "legalName": "Acme Fitness Ltd",
    "taxMode": "https://openactive.io/TaxGross",
    "termsOfService": [
      {
        "@type": "PrivacyPolicy",
        "name": "Privacy Policy",
        "requiresExplicitConsent": false,
        "url": "https://example.com/privacy.html"
      }
    ]
  },
  "totalPaymentDue": {
    "@type": "PriceSpecification",
    "openBookingPrepayment": "https://openactive.io/Required",
    "price": 11.77,
    "priceCurrency": "GBP"
  },
  "totalPaymentTax": [
    {
      "@type": "TaxChargeSpecification",
      "name": "VAT at 20%",
      "price": 2.354,
      "priceCurrency": "GBP",
      "rate": 0.2
    }
  ]
}
```
### Specs
* ‚úÖ should return 200 on success
* ‚úÖ Should have the same number of OrderItems as criteria
* ‚úÖ OrderItem at position 0 - capacities should not have changed from their initial values after C1/C2 (regardless of leasing)

## C1 >> validation of C1
### Specs
* ‚úÖ passes validation checks

### Validations
 * ‚ö†Ô∏è $.orderedItem[0].acceptedOffer.name: Recommended property `name` is missing from `Offer`.
 * ‚ö†Ô∏è $.orderedItem[0].acceptedOffer.ageRestriction: Recommended property `ageRestriction` is missing from `Offer`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.eventStatus: Recommended property `eventStatus` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.ageRange: Recommended property `ageRange` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.genderRestriction: Recommended property `genderRestriction` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.eventStatus: Recommended property `eventStatus` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.id: Recommended property `@id` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.url: Recommended property `url` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.description: Recommended property `description` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.image: Recommended property `image` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.telephone: Recommended property `telephone` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.openingHoursSpecification: Recommended property `openingHoursSpecification` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.amenityFeature: Recommended property `amenityFeature` is missing from `Place`.
 * ‚ö†Ô∏è $.seller.email: Recommended property `email` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.url: Recommended property `url` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.logo: Recommended property `logo` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.vatID: Recommended property `vatID` is missing from `Organization`.
 * üìù $.orderedItem[0].orderedItem.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `ScheduledSession`.
 * üìù $.orderedItem[0].orderedItem.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.orderedItem[0].orderedItem.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.orderedItem[0].orderedItem.superEvent.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `SessionSeries`.
 * üìù $.orderedItem[0].orderedItem.superEvent.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.orderedItem[0].orderedItem.superEvent.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.

## Assert Opportunity Capacity (after C1)

### Opportunity Feed extract for OrderItem 0 Request
GET http://localhost:3000/opportunity/https%3A%2F%2Flocalhost%3A5001%2Fapi%2Fidentifiers%2Fscheduled-sessions%2F1034%2Fevents%2F10332?useCacheIfAvailable=true&expectedCapacity=2


---
Response status code: 200 OK. Responded in 397.493309ms.
```json
{
  "state": "updated",
  "id": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332",
  "modified": 1658486880057,
  "data": {
    "@context": [
      "https://openactive.io/",
      "https://openactive.io/ns-beta"
    ],
    "@type": "ScheduledSession",
    "@id": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332",
    "startDate": "2022-08-01T07:24:11+00:00",
    "endDate": "2022-08-01T10:23:11+00:00",
    "superEvent": {
      "@type": "SessionSeries",
      "@id": "https://localhost:5001/api/identifiers/session-series/1034",
      "name": "Metal Zumba",
      "activity": [
        {
          "@type": "Concept",
          "@id": "https://openactive.io/activity-list#c07d63a0-8eb9-4602-8bcc-23be6deb8f83",
          "inScheme": "https://openactive.io/activity-list",
          "prefLabel": "Jet Skiing"
        }
      ],
      "eventAttendanceMode": "https://schema.org/OnlineEventAttendanceMode",
      "offers": [
        {
          "@type": "Offer",
          "@id": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
          "allowCustomerCancellationFullRefund": false,
          "openBookingFlowRequirement": [
            "https://openactive.io/OpenBookingApproval"
          ],
          "price": 11.77,
          "priceCurrency": "GBP"
        }
      ],
      "organizer": {
        "@type": "Organization",
        "@id": "https://localhost:5001/api/identifiers/sellers/1",
        "name": "Acme Fitness Ltd",
        "isOpenBookingAllowed": true,
        "taxMode": "https://openactive.io/TaxGross",
        "termsOfService": [
          {
            "@type": "PrivacyPolicy",
            "name": "Privacy Policy",
            "requiresExplicitConsent": false,
            "url": "https://example.com/privacy.html"
          }
        ]
      },
      "url": "https://www.example.com/a-session-age",
      "beta:affiliatedLocation": {
        "@type": "Place",
        "name": "Fake Pond",
        "address": {
          "@type": "PostalAddress",
          "addressCountry": "GB",
          "addressLocality": "Another town",
          "addressRegion": "Oxfordshire",
          "postalCode": "OX1 1AA",
          "streetAddress": "1 Fake Park"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 0,
          "longitude": 0
        }
      }
    },
    "duration": "PT2H59M",
    "maximumAttendeeCapacity": 3,
    "remainingAttendeeCapacity": 2
  }
}
```
### Specs
* ‚úÖ should return 200 on success for request relevant to OrderItem 0
* ‚úÖ should return `totalPaymentDue.openBookingPrepayment` '`https://openactive.io/Required`'

## Assert Opportunity Capacity (after C1) >> validation of Opportunity Feed extract for OrderItem 0
### Specs
* ‚úÖ passes validation checks

### Validations
 * ‚ö†Ô∏è $.eventStatus: Recommended property `eventStatus` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.leader: Recommended property `leader` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.url: Recommended property `url` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.superEvent.description: Recommended property `description` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.image: Recommended property `image` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.ageRange: Recommended property `ageRange` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.genderRestriction: Recommended property `genderRestriction` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.leader: Recommended property `leader` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.level: Recommended property `level` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.offers[0].name: Recommended property `name` is missing from `Offer`.
 * ‚ö†Ô∏è $.superEvent.offers[0].ageRestriction: Recommended property `ageRestriction` is missing from `Offer`.
 * ‚ö†Ô∏è $.superEvent.organizer.url: Recommended property `url` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent.organizer.telephone: Recommended property `telephone` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent.organizer.sameAs: Recommended property `sameAs` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].id: Recommended property `@id` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].url: Recommended property `url` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].description: Recommended property `description` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].image: Recommended property `image` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].telephone: Recommended property `telephone` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].openingHoursSpecification: Recommended property `openingHoursSpecification` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].amenityFeature: Recommended property `amenityFeature` is missing from `Place`.
 * üìù $.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `ScheduledSession`.
 * üìù $.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.superEvent.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `SessionSeries`.
 * üìù $.superEvent.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.superEvent.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.superEvent["beta:affiliatedLocation"].geo.latitude: The value of this property should have at least 3 decimal places. Note that this notice will also appear when trailing zeros have been truncated.
 * üìù $.superEvent["beta:affiliatedLocation"].geo.longitude: The value of this property should have at least 3 decimal places. Note that this notice will also appear when trailing zeros have been truncated.

## C2

### C2 Request
PUT https://localhost:5001/api/openbooking/order-quotes/58aecb7a-ee2f-4015-9608-a583c76f6aa7

* **Content-Type:** `"application/vnd.openactive.booking+json; version=1"`
* **Authorization:** `"Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IkIwNEY3QjkxREUzQjk0NzhDNjE4MzNGQjI0QUE1Q0RCIiwidHlwIjoiYXQrand0In0.eyJuYmYiOjE2NTg0ODU2NTYsImV4cCI6MTY1ODQ4OTI1NiwiaXNzIjoiaHR0cHM6Ly9sb2NhbGhvc3Q6NTAwMyIsImF1ZCI6Im9wZW5ib29raW5nIiwiY2xpZW50X2lkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwiaHR0cHM6Ly9vcGVuYWN0aXZlLmlvL2NsaWVudElkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwic3ViIjoiMTAwIiwiYXV0aF90aW1lIjoxNjU4NDg1NjU1LCJpZHAiOiJsb2NhbCIsImh0dHBzOi8vb3BlbmFjdGl2ZS5pby9zZWxsZXJJZCI6Imh0dHBzOi8vbG9jYWxob3N0OjUwMDEvYXBpL2lkZW50aWZpZXJzL3NlbGxlcnMvMSIsImp0aSI6IjkxQTNBNUUzMkU1NzZEODEyNkNGMjNCMDNFQkUzMUFBIiwic2lkIjoiMUFEM0IxMEQ5MDA4QkY0NzREMThFRTU2MzZEMDVBREYiLCJpYXQiOjE2NTg0ODU2NTYsInNjb3BlIjpbIm9wZW5pZCIsIm9wZW5hY3RpdmUtb3BlbmJvb2tpbmciLCJvcGVuYWN0aXZlLWlkZW50aXR5Iiwib2ZmbGluZV9hY2Nlc3MiXSwiYW1yIjpbInB3ZCJdfQ.a2EuRMF8HKqvnIK46S7jGAnFYJTLs5usIok3hM1GayeDD5bQGinKSWhljkFFzPUIey5JBLEDu-ncYu-gmWg85CyMyWM9tUvfXdyzUDelvQDh3aKsUQ82RB-flVXtzeTGkWKx57d03Cfzne_1lnhP0C9P6FWsUueTy_yw_4txHVgbA4y7FYcos624uxw0DUDYakjtSHoOQpXsWzzYUp20Ax_cxJC_zvpslDxQBFX3jTSXKDurUmkVGcFDiC-sRZLvRw9A5iAscUsSLbZBLF-oBQJOYFcXXeT2UsdJLx15MUh9_zKZ932UtV3XtWf8F47Dw8uSfvOl41VL7Q-zTfwKKg"`

```json
{
  "@context": "https://openactive.io/",
  "@type": "OrderQuote",
  "brokerRole": "https://openactive.io/AgentBroker",
  "broker": {
    "@type": "Organization",
    "name": "MyFitnessApp",
    "url": "https://myfitnessapp.example.com",
    "description": "A fitness app for all the community",
    "logo": {
      "@type": "ImageObject",
      "url": "http://data.myfitnessapp.org.uk/images/logo.png"
    },
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Alan Peacock Way",
      "addressLocality": "Village East",
      "addressRegion": "Middlesbrough",
      "postalCode": "TS4 3AE",
      "addressCountry": "GB"
    }
  },
  "seller": "https://localhost:5001/api/identifiers/sellers/1",
  "customer": {
    "@type": "Person",
    "email": "Addison_Reynolds@hotmail.com",
    "telephone": "721-359-7603 x7149",
    "givenName": "Adams",
    "familyName": "Aileen",
    "identifier": "aa23d4ba-7012-46cf-8fdc-ada1811a1dcb"
  },
  "orderedItem": [
    {
      "@type": "OrderItem",
      "position": 0,
      "acceptedOffer": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
      "orderedItem": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332"
    }
  ],
  "payment": {
    "@type": "Payment",
    "name": "AcmeBroker Points",
    "accountId": "SN1593",
    "paymentProviderId": "STRIPE"
  }
}
```

---
Response status code: 200 OK. Responded in 531.130402ms.
```json
{
  "@context": "https://openactive.io/",
  "@type": "OrderQuote",
  "@id": "https://localhost:5001/api/openbooking/order-quotes/58aecb7a-ee2f-4015-9608-a583c76f6aa7",
  "lease": {
    "@type": "Lease",
    "leaseExpires": "2022-07-22T10:52:59+00:00"
  },
  "orderRequiresApproval": true,
  "bookingService": {
    "@type": "BookingService",
    "name": "Acme booking system",
    "termsOfService": [
      {
        "@type": "PrivacyPolicy",
        "name": "Privacy Policy",
        "requiresExplicitConsent": false,
        "url": "https://example.com/privacy.html"
      }
    ],
    "url": "https://example.com"
  },
  "broker": {
    "@type": "Organization",
    "name": "MyFitnessApp",
    "url": "https://myfitnessapp.example.com"
  },
  "brokerRole": "https://openactive.io/AgentBroker",
  "customer": {
    "@type": "Person",
    "identifier": "aa23d4ba-7012-46cf-8fdc-ada1811a1dcb",
    "email": "Addison_Reynolds@hotmail.com",
    "familyName": "Aileen",
    "givenName": "Adams",
    "telephone": "721-359-7603 x7149"
  },
  "orderedItem": [
    {
      "@type": "OrderItem",
      "acceptedOffer": {
        "@type": "Offer",
        "@id": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
        "allowCustomerCancellationFullRefund": false,
        "price": 11.77,
        "priceCurrency": "GBP"
      },
      "orderedItem": {
        "@type": "ScheduledSession",
        "@id": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332",
        "startDate": "2022-08-01T07:24:11+00:00",
        "endDate": "2022-08-01T10:23:11+00:00",
        "superEvent": {
          "@type": "SessionSeries",
          "@id": "https://localhost:5001/api/identifiers/session-series/1034",
          "name": "Metal Zumba",
          "activity": [
            {
              "@type": "Concept",
              "@id": "https://openactive.io/activity-list#6bdea630-ad22-4e58-98a3-bca26ee3f1da",
              "inScheme": "https://openactive.io/activity-list",
              "prefLabel": "Rave Fitness"
            }
          ],
          "location": {
            "@type": "Place",
            "name": "Fake fitness studio",
            "geo": {
              "@type": "GeoCoordinates",
              "latitude": 51.6201,
              "longitude": 0.302396
            }
          },
          "url": "https://example.com/events/1034"
        },
        "maximumAttendeeCapacity": 3,
        "remainingAttendeeCapacity": 3
      },
      "position": 0,
      "unitTaxSpecification": [
        {
          "@type": "TaxChargeSpecification",
          "name": "VAT at 20%",
          "price": 2.354,
          "priceCurrency": "GBP",
          "rate": 0.2
        }
      ]
    }
  ],
  "payment": {
    "@type": "Payment",
    "name": "AcmeBroker Points",
    "accountId": "SN1593",
    "paymentProviderId": "STRIPE"
  },
  "seller": {
    "@type": "Organization",
    "@id": "https://localhost:5001/api/identifiers/sellers/1",
    "name": "Acme Fitness Ltd",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "GB",
      "addressLocality": "Another town",
      "addressRegion": "Oxfordshire",
      "postalCode": "OX1 1AA",
      "streetAddress": "1 Hidden Gem"
    },
    "isOpenBookingAllowed": true,
    "legalName": "Acme Fitness Ltd",
    "taxMode": "https://openactive.io/TaxGross",
    "termsOfService": [
      {
        "@type": "PrivacyPolicy",
        "name": "Privacy Policy",
        "requiresExplicitConsent": false,
        "url": "https://example.com/privacy.html"
      }
    ]
  },
  "totalPaymentDue": {
    "@type": "PriceSpecification",
    "openBookingPrepayment": "https://openactive.io/Required",
    "price": 11.77,
    "priceCurrency": "GBP"
  },
  "totalPaymentTax": [
    {
      "@type": "TaxChargeSpecification",
      "name": "VAT at 20%",
      "price": 2.354,
      "priceCurrency": "GBP",
      "rate": 0.2
    }
  ]
}
```
### Specs
* ‚úÖ should return 200 on success
* ‚úÖ Should have the same number of OrderItems as criteria
* ‚úÖ OrderItem at position 0 - capacities should not have changed from their initial values after C1/C2 (regardless of leasing)

## C2 >> validation of C2
### Specs
* ‚úÖ passes validation checks

### Validations
 * ‚ö†Ô∏è $.orderedItem[0].acceptedOffer.name: Recommended property `name` is missing from `Offer`.
 * ‚ö†Ô∏è $.orderedItem[0].acceptedOffer.ageRestriction: Recommended property `ageRestriction` is missing from `Offer`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.eventStatus: Recommended property `eventStatus` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.ageRange: Recommended property `ageRange` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.genderRestriction: Recommended property `genderRestriction` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.eventStatus: Recommended property `eventStatus` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.id: Recommended property `@id` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.url: Recommended property `url` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.description: Recommended property `description` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.image: Recommended property `image` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.telephone: Recommended property `telephone` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.openingHoursSpecification: Recommended property `openingHoursSpecification` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.amenityFeature: Recommended property `amenityFeature` is missing from `Place`.
 * ‚ö†Ô∏è $.seller.email: Recommended property `email` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.url: Recommended property `url` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.logo: Recommended property `logo` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.vatID: Recommended property `vatID` is missing from `Organization`.
 * üìù $.orderedItem[0].orderedItem.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `ScheduledSession`.
 * üìù $.orderedItem[0].orderedItem.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.orderedItem[0].orderedItem.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.orderedItem[0].orderedItem.superEvent.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `SessionSeries`.
 * üìù $.orderedItem[0].orderedItem.superEvent.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.orderedItem[0].orderedItem.superEvent.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.

## Assert Opportunity Capacity (after C2)

### Opportunity Feed extract for OrderItem 0 Request
GET http://localhost:3000/opportunity/https%3A%2F%2Flocalhost%3A5001%2Fapi%2Fidentifiers%2Fscheduled-sessions%2F1034%2Fevents%2F10332?useCacheIfAvailable=true&expectedCapacity=2


---
Response status code: 200 OK. Responded in 19.489808ms.
```json
{
  "data": {
    "@context": [
      "https://openactive.io/",
      "https://openactive.io/ns-beta"
    ],
    "@type": "ScheduledSession",
    "@id": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332",
    "startDate": "2022-08-01T07:24:11+00:00",
    "endDate": "2022-08-01T10:23:11+00:00",
    "superEvent": {
      "@type": "SessionSeries",
      "@id": "https://localhost:5001/api/identifiers/session-series/1034",
      "name": "Metal Zumba",
      "activity": [
        {
          "@type": "Concept",
          "@id": "https://openactive.io/activity-list#c07d63a0-8eb9-4602-8bcc-23be6deb8f83",
          "inScheme": "https://openactive.io/activity-list",
          "prefLabel": "Jet Skiing"
        }
      ],
      "eventAttendanceMode": "https://schema.org/OnlineEventAttendanceMode",
      "offers": [
        {
          "@type": "Offer",
          "@id": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
          "allowCustomerCancellationFullRefund": false,
          "openBookingFlowRequirement": [
            "https://openactive.io/OpenBookingApproval"
          ],
          "price": 11.77,
          "priceCurrency": "GBP"
        }
      ],
      "organizer": {
        "@type": "Organization",
        "@id": "https://localhost:5001/api/identifiers/sellers/1",
        "name": "Acme Fitness Ltd",
        "isOpenBookingAllowed": true,
        "taxMode": "https://openactive.io/TaxGross",
        "termsOfService": [
          {
            "@type": "PrivacyPolicy",
            "name": "Privacy Policy",
            "requiresExplicitConsent": false,
            "url": "https://example.com/privacy.html"
          }
        ]
      },
      "url": "https://www.example.com/a-session-age",
      "beta:affiliatedLocation": {
        "@type": "Place",
        "name": "Fake Pond",
        "address": {
          "@type": "PostalAddress",
          "addressCountry": "GB",
          "addressLocality": "Another town",
          "addressRegion": "Oxfordshire",
          "postalCode": "OX1 1AA",
          "streetAddress": "1 Fake Park"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 0,
          "longitude": 0
        }
      }
    },
    "duration": "PT2H59M",
    "maximumAttendeeCapacity": 3,
    "remainingAttendeeCapacity": 2
  }
}
```
### Specs
* ‚úÖ should return 200 on success for request relevant to OrderItem 0
* ‚úÖ should return `totalPaymentDue.openBookingPrepayment` '`https://openactive.io/Required`'

## Assert Opportunity Capacity (after C2) >> validation of Opportunity Feed extract for OrderItem 0
### Specs
* ‚úÖ passes validation checks

### Validations
 * ‚ö†Ô∏è $.eventStatus: Recommended property `eventStatus` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.leader: Recommended property `leader` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.url: Recommended property `url` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.superEvent.description: Recommended property `description` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.image: Recommended property `image` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.ageRange: Recommended property `ageRange` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.genderRestriction: Recommended property `genderRestriction` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.leader: Recommended property `leader` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.level: Recommended property `level` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.offers[0].name: Recommended property `name` is missing from `Offer`.
 * ‚ö†Ô∏è $.superEvent.offers[0].ageRestriction: Recommended property `ageRestriction` is missing from `Offer`.
 * ‚ö†Ô∏è $.superEvent.organizer.url: Recommended property `url` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent.organizer.telephone: Recommended property `telephone` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent.organizer.sameAs: Recommended property `sameAs` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].id: Recommended property `@id` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].url: Recommended property `url` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].description: Recommended property `description` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].image: Recommended property `image` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].telephone: Recommended property `telephone` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].openingHoursSpecification: Recommended property `openingHoursSpecification` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].amenityFeature: Recommended property `amenityFeature` is missing from `Place`.
 * üìù $.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `ScheduledSession`.
 * üìù $.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.superEvent.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `SessionSeries`.
 * üìù $.superEvent.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.superEvent.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.superEvent["beta:affiliatedLocation"].geo.latitude: The value of this property should have at least 3 decimal places. Note that this notice will also appear when trailing zeros have been truncated.
 * üìù $.superEvent["beta:affiliatedLocation"].geo.longitude: The value of this property should have at least 3 decimal places. Note that this notice will also appear when trailing zeros have been truncated.

## P

### P Request
PUT https://localhost:5001/api/openbooking/order-proposals/58aecb7a-ee2f-4015-9608-a583c76f6aa7

* **Content-Type:** `"application/vnd.openactive.booking+json; version=1"`
* **Authorization:** `"Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IkIwNEY3QjkxREUzQjk0NzhDNjE4MzNGQjI0QUE1Q0RCIiwidHlwIjoiYXQrand0In0.eyJuYmYiOjE2NTg0ODU2NTYsImV4cCI6MTY1ODQ4OTI1NiwiaXNzIjoiaHR0cHM6Ly9sb2NhbGhvc3Q6NTAwMyIsImF1ZCI6Im9wZW5ib29raW5nIiwiY2xpZW50X2lkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwiaHR0cHM6Ly9vcGVuYWN0aXZlLmlvL2NsaWVudElkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwic3ViIjoiMTAwIiwiYXV0aF90aW1lIjoxNjU4NDg1NjU1LCJpZHAiOiJsb2NhbCIsImh0dHBzOi8vb3BlbmFjdGl2ZS5pby9zZWxsZXJJZCI6Imh0dHBzOi8vbG9jYWxob3N0OjUwMDEvYXBpL2lkZW50aWZpZXJzL3NlbGxlcnMvMSIsImp0aSI6IjkxQTNBNUUzMkU1NzZEODEyNkNGMjNCMDNFQkUzMUFBIiwic2lkIjoiMUFEM0IxMEQ5MDA4QkY0NzREMThFRTU2MzZEMDVBREYiLCJpYXQiOjE2NTg0ODU2NTYsInNjb3BlIjpbIm9wZW5pZCIsIm9wZW5hY3RpdmUtb3BlbmJvb2tpbmciLCJvcGVuYWN0aXZlLWlkZW50aXR5Iiwib2ZmbGluZV9hY2Nlc3MiXSwiYW1yIjpbInB3ZCJdfQ.a2EuRMF8HKqvnIK46S7jGAnFYJTLs5usIok3hM1GayeDD5bQGinKSWhljkFFzPUIey5JBLEDu-ncYu-gmWg85CyMyWM9tUvfXdyzUDelvQDh3aKsUQ82RB-flVXtzeTGkWKx57d03Cfzne_1lnhP0C9P6FWsUueTy_yw_4txHVgbA4y7FYcos624uxw0DUDYakjtSHoOQpXsWzzYUp20Ax_cxJC_zvpslDxQBFX3jTSXKDurUmkVGcFDiC-sRZLvRw9A5iAscUsSLbZBLF-oBQJOYFcXXeT2UsdJLx15MUh9_zKZ932UtV3XtWf8F47Dw8uSfvOl41VL7Q-zTfwKKg"`

```json
{
  "@context": "https://openactive.io/",
  "@type": "OrderProposal",
  "brokerRole": "https://openactive.io/AgentBroker",
  "broker": {
    "@type": "Organization",
    "name": "MyFitnessApp",
    "url": "https://myfitnessapp.example.com",
    "description": "A fitness app for all the community",
    "logo": {
      "@type": "ImageObject",
      "url": "http://data.myfitnessapp.org.uk/images/logo.png"
    },
    "address": {
      "@type": "PostalAddress",
      "streetAddress": "Alan Peacock Way",
      "addressLocality": "Village East",
      "addressRegion": "Middlesbrough",
      "postalCode": "TS4 3AE",
      "addressCountry": "GB"
    }
  },
  "seller": "https://localhost:5001/api/identifiers/sellers/1",
  "customer": {
    "@type": "Person",
    "email": "Addison_Reynolds@hotmail.com",
    "telephone": "721-359-7603 x7149",
    "givenName": "Adams",
    "familyName": "Aileen",
    "identifier": "aa23d4ba-7012-46cf-8fdc-ada1811a1dcb"
  },
  "orderedItem": [
    {
      "@type": "OrderItem",
      "position": 0,
      "acceptedOffer": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
      "orderedItem": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332"
    }
  ],
  "totalPaymentDue": {
    "@type": "PriceSpecification",
    "price": 11.77,
    "priceCurrency": "GBP"
  },
  "payment": {
    "@type": "Payment",
    "identifier": "eQcXLVrQN",
    "name": "AcmeBroker Points",
    "accountId": "SN1593",
    "paymentProviderId": "STRIPE"
  }
}
```

---
Response status code: 201 Created. Responded in 396.821395ms.
```json
{
  "@context": "https://openactive.io/",
  "@type": "OrderProposal",
  "@id": "https://localhost:5001/api/openbooking/order-proposals/58aecb7a-ee2f-4015-9608-a583c76f6aa7",
  "orderProposalStatus": "https://openactive.io/AwaitingSellerConfirmation",
  "bookingService": {
    "@type": "BookingService",
    "name": "Acme booking system",
    "termsOfService": [
      {
        "@type": "PrivacyPolicy",
        "name": "Privacy Policy",
        "requiresExplicitConsent": false,
        "url": "https://example.com/privacy.html"
      }
    ],
    "url": "https://example.com"
  },
  "broker": {
    "@type": "Organization",
    "name": "MyFitnessApp",
    "url": "https://myfitnessapp.example.com"
  },
  "brokerRole": "https://openactive.io/AgentBroker",
  "customer": {
    "@type": "Person",
    "identifier": "aa23d4ba-7012-46cf-8fdc-ada1811a1dcb",
    "email": "Addison_Reynolds@hotmail.com",
    "familyName": "Aileen",
    "givenName": "Adams",
    "telephone": "721-359-7603 x7149"
  },
  "orderedItem": [
    {
      "@type": "OrderItem",
      "@id": "https://localhost:5001/api/openbooking/orders/58aecb7a-ee2f-4015-9608-a583c76f6aa7#/orderedItems/2555",
      "acceptedOffer": {
        "@type": "Offer",
        "@id": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
        "allowCustomerCancellationFullRefund": false,
        "price": 11.77,
        "priceCurrency": "GBP"
      },
      "orderedItem": {
        "@type": "ScheduledSession",
        "@id": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332",
        "startDate": "2022-08-01T07:24:11+00:00",
        "endDate": "2022-08-01T10:23:11+00:00",
        "superEvent": {
          "@type": "SessionSeries",
          "@id": "https://localhost:5001/api/identifiers/session-series/1034",
          "name": "Metal Zumba",
          "activity": [
            {
              "@type": "Concept",
              "@id": "https://openactive.io/activity-list#6bdea630-ad22-4e58-98a3-bca26ee3f1da",
              "inScheme": "https://openactive.io/activity-list",
              "prefLabel": "Rave Fitness"
            }
          ],
          "location": {
            "@type": "Place",
            "name": "Fake fitness studio",
            "geo": {
              "@type": "GeoCoordinates",
              "latitude": 51.6201,
              "longitude": 0.302396
            }
          },
          "url": "https://example.com/events/1034"
        },
        "maximumAttendeeCapacity": 3,
        "remainingAttendeeCapacity": 3
      },
      "position": 0,
      "unitTaxSpecification": [
        {
          "@type": "TaxChargeSpecification",
          "name": "VAT at 20%",
          "price": 2.354,
          "priceCurrency": "GBP",
          "rate": 0.2
        }
      ]
    }
  ],
  "orderProposalVersion": "https://localhost:5001/api/openbooking/order-proposals/58aecb7a-ee2f-4015-9608-a583c76f6aa7/versions/a3a58c38-25e9-4ccd-b0d7-6f80d28e851c",
  "payment": {
    "@type": "Payment",
    "identifier": "eQcXLVrQN",
    "name": "AcmeBroker Points",
    "accountId": "SN1593",
    "paymentProviderId": "STRIPE"
  },
  "seller": {
    "@type": "Organization",
    "@id": "https://localhost:5001/api/identifiers/sellers/1",
    "name": "Acme Fitness Ltd",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "GB",
      "addressLocality": "Another town",
      "addressRegion": "Oxfordshire",
      "postalCode": "OX1 1AA",
      "streetAddress": "1 Hidden Gem"
    },
    "isOpenBookingAllowed": true,
    "legalName": "Acme Fitness Ltd",
    "taxMode": "https://openactive.io/TaxGross",
    "termsOfService": [
      {
        "@type": "PrivacyPolicy",
        "name": "Privacy Policy",
        "requiresExplicitConsent": false,
        "url": "https://example.com/privacy.html"
      }
    ]
  },
  "totalPaymentDue": {
    "@type": "PriceSpecification",
    "openBookingPrepayment": "https://openactive.io/Required",
    "price": 11.77,
    "priceCurrency": "GBP"
  },
  "totalPaymentTax": [
    {
      "@type": "TaxChargeSpecification",
      "name": "VAT at 20%",
      "price": 2.354,
      "priceCurrency": "GBP",
      "rate": 0.2
    }
  ]
}
```
### Specs
* ‚úÖ should return 201 on success

## P >> validation of P
### Specs
* ‚úÖ passes validation checks

### Validations
 * ‚ö†Ô∏è $.orderedItem[0].acceptedOffer.name: Recommended property `name` is missing from `Offer`.
 * ‚ö†Ô∏è $.orderedItem[0].acceptedOffer.ageRestriction: Recommended property `ageRestriction` is missing from `Offer`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.eventStatus: Recommended property `eventStatus` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.ageRange: Recommended property `ageRange` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.genderRestriction: Recommended property `genderRestriction` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.eventStatus: Recommended property `eventStatus` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.id: Recommended property `@id` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.url: Recommended property `url` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.description: Recommended property `description` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.image: Recommended property `image` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.telephone: Recommended property `telephone` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.openingHoursSpecification: Recommended property `openingHoursSpecification` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.amenityFeature: Recommended property `amenityFeature` is missing from `Place`.
 * ‚ö†Ô∏è $.seller.email: Recommended property `email` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.url: Recommended property `url` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.logo: Recommended property `logo` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.vatID: Recommended property `vatID` is missing from `Organization`.
 * üìù $.orderedItem[0].orderedItem.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `ScheduledSession`.
 * üìù $.orderedItem[0].orderedItem.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.orderedItem[0].orderedItem.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.orderedItem[0].orderedItem.superEvent.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `SessionSeries`.
 * üìù $.orderedItem[0].orderedItem.superEvent.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.orderedItem[0].orderedItem.superEvent.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.

## Simulate Seller Approval (Test Interface Action)

### Orders (order-proposals) Feed listen for &#x27;58aecb7a-ee2f-4015-9608-a583c76f6aa7&#x27; change (auth: primary) Request
POST http://localhost:3000/order-listeners/order-proposals/primary/58aecb7a-ee2f-4015-9608-a583c76f6aa7


---
Response status code: 200 OK. Responded in 10.253515ms.
```json
{
  "headers": {
    "Accept": "application/json, application/vnd.openactive.booking+json; version=1",
    "Cache-Control": "max-age=0",
    "Authorization": "Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IkIwNEY3QjkxREUzQjk0NzhDNjE4MzNGQjI0QUE1Q0RCIiwidHlwIjoiYXQrand0In0.eyJuYmYiOjE2NTg0ODU2NTMsImV4cCI6MTY1ODQ4OTI1MywiaXNzIjoiaHR0cHM6Ly9sb2NhbGhvc3Q6NTAwMyIsImF1ZCI6Im9wZW5ib29raW5nIiwiY2xpZW50X2lkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwiaHR0cHM6Ly9vcGVuYWN0aXZlLmlvL2NsaWVudElkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwianRpIjoiRTUxRTkyMDc1MkYwNzExRDkyNTM3RUZDN0FBOEZCRDEiLCJpYXQiOjE2NTg0ODU2NTMsInNjb3BlIjpbIm9wZW5hY3RpdmUtb3JkZXJzZmVlZCJdfQ.e7zQHg-DDRNahiuTzaFV254wrt3eLDQXtbMDrCXDv1lbcIlUPVmndLEFPxJc8KAmv3E1eco3WPz4nCe5goBIhrneK6n9hBkCRJC6GCPmlmIGev6e_CwisuvqB-eDEN65BOY04UEIu_0EjqwYZihJVEJO6DoEiz9b8e3cyDU9RWp4IMmQt3SbW__Tuk6bBwbNWBJNR3sOlWQfI7qIbzWFJ1J2GLMDxr53kRGSgkpIzad8T9HDfRFNn0Beu5kbMm1DUHz-k_liYyZaxpdSbHz6xQcUpbULHFId_PGJeScrNTsM1raJLOWZ_6tTKP2IyhKQ_D5fb_6GBl9eyB3VC9LCRw"
  },
  "startingFeedPage": "https://localhost:5001/api/openbooking/order-proposals-rpde?afterTimestamp=637940836787677845&afterId=b154d93c-1bc2-44f9-88ea-f22ad7655238",
  "message": "Listening for UUID: '58aecb7a-ee2f-4015-9608-a583c76f6aa7' in feed: order-proposals, for Booking Partner: primary from startingFeedPage using headers"
}
```

### Call TestInterface Action of type: test:SellerAcceptOrderProposalSimulateAction Request
POST https://localhost:5001/api/openbooking/test-interface/actions

* **Content-Type:** `"application/vnd.openactive.booking+json; version=1"`
* **Authorization:** `"Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IkIwNEY3QjkxREUzQjk0NzhDNjE4MzNGQjI0QUE1Q0RCIiwidHlwIjoiYXQrand0In0.eyJuYmYiOjE2NTg0ODU2NTYsImV4cCI6MTY1ODQ4OTI1NiwiaXNzIjoiaHR0cHM6Ly9sb2NhbGhvc3Q6NTAwMyIsImF1ZCI6Im9wZW5ib29raW5nIiwiY2xpZW50X2lkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwiaHR0cHM6Ly9vcGVuYWN0aXZlLmlvL2NsaWVudElkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwic3ViIjoiMTAwIiwiYXV0aF90aW1lIjoxNjU4NDg1NjU1LCJpZHAiOiJsb2NhbCIsImh0dHBzOi8vb3BlbmFjdGl2ZS5pby9zZWxsZXJJZCI6Imh0dHBzOi8vbG9jYWxob3N0OjUwMDEvYXBpL2lkZW50aWZpZXJzL3NlbGxlcnMvMSIsImp0aSI6IjkxQTNBNUUzMkU1NzZEODEyNkNGMjNCMDNFQkUzMUFBIiwic2lkIjoiMUFEM0IxMEQ5MDA4QkY0NzREMThFRTU2MzZEMDVBREYiLCJpYXQiOjE2NTg0ODU2NTYsInNjb3BlIjpbIm9wZW5pZCIsIm9wZW5hY3RpdmUtb3BlbmJvb2tpbmciLCJvcGVuYWN0aXZlLWlkZW50aXR5Iiwib2ZmbGluZV9hY2Nlc3MiXSwiYW1yIjpbInB3ZCJdfQ.a2EuRMF8HKqvnIK46S7jGAnFYJTLs5usIok3hM1GayeDD5bQGinKSWhljkFFzPUIey5JBLEDu-ncYu-gmWg85CyMyWM9tUvfXdyzUDelvQDh3aKsUQ82RB-flVXtzeTGkWKx57d03Cfzne_1lnhP0C9P6FWsUueTy_yw_4txHVgbA4y7FYcos624uxw0DUDYakjtSHoOQpXsWzzYUp20Ax_cxJC_zvpslDxQBFX3jTSXKDurUmkVGcFDiC-sRZLvRw9A5iAscUsSLbZBLF-oBQJOYFcXXeT2UsdJLx15MUh9_zKZ932UtV3XtWf8F47Dw8uSfvOl41VL7Q-zTfwKKg"`

```json
{
  "@context": [
    "https://openactive.io/",
    "https://openactive.io/test-interface"
  ],
  "@type": "test:SellerAcceptOrderProposalSimulateAction",
  "object": {
    "@type": "OrderProposal",
    "@id": "https://localhost:5001/api/openbooking/order-proposals/58aecb7a-ee2f-4015-9608-a583c76f6aa7"
  }
}
```

---
Response status code: 204 No Content. Responded in 538.471355ms.
### Specs
* ‚úÖ should return 204 on success

## OrderProposal Feed Update (after Simulate Seller Approval)

### Orders (order-proposals) Feed collect for &#x27;58aecb7a-ee2f-4015-9608-a583c76f6aa7&#x27; change (auth: primary) Request
GET http://localhost:3000/order-listeners/order-proposals/primary/58aecb7a-ee2f-4015-9608-a583c76f6aa7


---
Response status code: 200 OK. Responded in 2259.237796ms.
```json
{
  "state": "updated",
  "kind": "Order",
  "id": "58aecb7a-ee2f-4015-9608-a583c76f6aa7",
  "modified": 637940836817748200,
  "data": {
    "@context": "https://openactive.io/",
    "@type": "OrderProposal",
    "@id": "https://localhost:5001/api/openbooking/order-proposals/58aecb7a-ee2f-4015-9608-a583c76f6aa7",
    "identifier": "58aecb7a-ee2f-4015-9608-a583c76f6aa7",
    "orderProposalStatus": "https://openactive.io/SellerAccepted",
    "orderedItem": [
      {
        "@type": "OrderItem",
        "@id": "https://localhost:5001/api/openbooking/orders/58aecb7a-ee2f-4015-9608-a583c76f6aa7#/orderedItems/2555",
        "acceptedOffer": {
          "@type": "Offer",
          "@id": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
          "price": 11.77,
          "priceCurrency": "GBP"
        },
        "orderedItem": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332"
      }
    ],
    "orderProposalVersion": "https://localhost:5001/api/openbooking/order-proposals/58aecb7a-ee2f-4015-9608-a583c76f6aa7/versions/a3a58c38-25e9-4ccd-b0d7-6f80d28e851c",
    "totalPaymentDue": {
      "@type": "PriceSpecification",
      "openBookingPrepayment": "https://openactive.io/Required",
      "price": 11.77,
      "priceCurrency": "GBP"
    }
  }
}
```
### Specs
* ‚úÖ should return 200 on success

## OrderProposal Feed Update (after Simulate Seller Approval) >> validation of OrderFeed
### Specs
* ‚úÖ passes validation checks

### Validations
 * ‚ö†Ô∏è $.orderedItem[0].acceptedOffer.name: Recommended property `name` is missing from `Offer`.
 * ‚ö†Ô∏è $.orderedItem[0].acceptedOffer.ageRestriction: Recommended property `ageRestriction` is missing from `Offer`.
 * ‚ö†Ô∏è $.orderedItem[0].acceptedOffer.allowCustomerCancellationFullRefund: Recommended property `allowCustomerCancellationFullRefund` is missing from `Offer`.

## B

### Orders (order-proposals) Feed listen for &#x27;58aecb7a-ee2f-4015-9608-a583c76f6aa7&#x27; change (auth: primary) Request
POST http://localhost:3000/order-listeners/order-proposals/primary/58aecb7a-ee2f-4015-9608-a583c76f6aa7


---
Response status code: 200 OK. Responded in 20.534042ms.
```json
{
  "headers": {
    "Accept": "application/json, application/vnd.openactive.booking+json; version=1",
    "Cache-Control": "max-age=0",
    "Authorization": "Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IkIwNEY3QjkxREUzQjk0NzhDNjE4MzNGQjI0QUE1Q0RCIiwidHlwIjoiYXQrand0In0.eyJuYmYiOjE2NTg0ODU2NTMsImV4cCI6MTY1ODQ4OTI1MywiaXNzIjoiaHR0cHM6Ly9sb2NhbGhvc3Q6NTAwMyIsImF1ZCI6Im9wZW5ib29raW5nIiwiY2xpZW50X2lkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwiaHR0cHM6Ly9vcGVuYWN0aXZlLmlvL2NsaWVudElkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwianRpIjoiRTUxRTkyMDc1MkYwNzExRDkyNTM3RUZDN0FBOEZCRDEiLCJpYXQiOjE2NTg0ODU2NTMsInNjb3BlIjpbIm9wZW5hY3RpdmUtb3JkZXJzZmVlZCJdfQ.e7zQHg-DDRNahiuTzaFV254wrt3eLDQXtbMDrCXDv1lbcIlUPVmndLEFPxJc8KAmv3E1eco3WPz4nCe5goBIhrneK6n9hBkCRJC6GCPmlmIGev6e_CwisuvqB-eDEN65BOY04UEIu_0EjqwYZihJVEJO6DoEiz9b8e3cyDU9RWp4IMmQt3SbW__Tuk6bBwbNWBJNR3sOlWQfI7qIbzWFJ1J2GLMDxr53kRGSgkpIzad8T9HDfRFNn0Beu5kbMm1DUHz-k_liYyZaxpdSbHz6xQcUpbULHFId_PGJeScrNTsM1raJLOWZ_6tTKP2IyhKQ_D5fb_6GBl9eyB3VC9LCRw"
  },
  "startingFeedPage": "https://localhost:5001/api/openbooking/order-proposals-rpde?afterTimestamp=637940836817748268&afterId=58aecb7a-ee2f-4015-9608-a583c76f6aa7",
  "message": "Listening for UUID: '58aecb7a-ee2f-4015-9608-a583c76f6aa7' in feed: order-proposals, for Booking Partner: primary from startingFeedPage using headers"
}
```

### B Request
PUT https://localhost:5001/api/openbooking/orders/58aecb7a-ee2f-4015-9608-a583c76f6aa7

* **Content-Type:** `"application/vnd.openactive.booking+json; version=1"`
* **Authorization:** `"Bearer eyJhbGciOiJSUzI1NiIsImtpZCI6IkIwNEY3QjkxREUzQjk0NzhDNjE4MzNGQjI0QUE1Q0RCIiwidHlwIjoiYXQrand0In0.eyJuYmYiOjE2NTg0ODU2NTYsImV4cCI6MTY1ODQ4OTI1NiwiaXNzIjoiaHR0cHM6Ly9sb2NhbGhvc3Q6NTAwMyIsImF1ZCI6Im9wZW5ib29raW5nIiwiY2xpZW50X2lkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwiaHR0cHM6Ly9vcGVuYWN0aXZlLmlvL2NsaWVudElkIjoiNTYwZGJjNzUtZTQ0Yy00YjAzLWExMGMtOTIxMTk3YWFlM2ExIiwic3ViIjoiMTAwIiwiYXV0aF90aW1lIjoxNjU4NDg1NjU1LCJpZHAiOiJsb2NhbCIsImh0dHBzOi8vb3BlbmFjdGl2ZS5pby9zZWxsZXJJZCI6Imh0dHBzOi8vbG9jYWxob3N0OjUwMDEvYXBpL2lkZW50aWZpZXJzL3NlbGxlcnMvMSIsImp0aSI6IjkxQTNBNUUzMkU1NzZEODEyNkNGMjNCMDNFQkUzMUFBIiwic2lkIjoiMUFEM0IxMEQ5MDA4QkY0NzREMThFRTU2MzZEMDVBREYiLCJpYXQiOjE2NTg0ODU2NTYsInNjb3BlIjpbIm9wZW5pZCIsIm9wZW5hY3RpdmUtb3BlbmJvb2tpbmciLCJvcGVuYWN0aXZlLWlkZW50aXR5Iiwib2ZmbGluZV9hY2Nlc3MiXSwiYW1yIjpbInB3ZCJdfQ.a2EuRMF8HKqvnIK46S7jGAnFYJTLs5usIok3hM1GayeDD5bQGinKSWhljkFFzPUIey5JBLEDu-ncYu-gmWg85CyMyWM9tUvfXdyzUDelvQDh3aKsUQ82RB-flVXtzeTGkWKx57d03Cfzne_1lnhP0C9P6FWsUueTy_yw_4txHVgbA4y7FYcos624uxw0DUDYakjtSHoOQpXsWzzYUp20Ax_cxJC_zvpslDxQBFX3jTSXKDurUmkVGcFDiC-sRZLvRw9A5iAscUsSLbZBLF-oBQJOYFcXXeT2UsdJLx15MUh9_zKZ932UtV3XtWf8F47Dw8uSfvOl41VL7Q-zTfwKKg"`

```json
{
  "@context": "https://openactive.io/",
  "@type": "Order",
  "orderProposalVersion": "https://localhost:5001/api/openbooking/order-proposals/58aecb7a-ee2f-4015-9608-a583c76f6aa7/versions/a3a58c38-25e9-4ccd-b0d7-6f80d28e851c",
  "payment": {
    "@type": "Payment",
    "identifier": "xUzs-U4LD",
    "name": "AcmeBroker Points",
    "accountId": "SN1593",
    "paymentProviderId": "STRIPE"
  }
}
```

---
Response status code: 201 Created. Responded in 149.640996ms.
```json
{
  "@context": "https://openactive.io/",
  "@type": "Order",
  "@id": "https://localhost:5001/api/openbooking/orders/58aecb7a-ee2f-4015-9608-a583c76f6aa7",
  "identifier": "58aecb7a-ee2f-4015-9608-a583c76f6aa7",
  "bookingService": {
    "@type": "BookingService",
    "name": "Acme booking system",
    "termsOfService": [
      {
        "@type": "PrivacyPolicy",
        "name": "Privacy Policy",
        "requiresExplicitConsent": false,
        "url": "https://example.com/privacy.html"
      }
    ],
    "url": "https://example.com"
  },
  "broker": {
    "@type": "Organization",
    "name": "MyFitnessApp",
    "url": "https://myfitnessapp.example.com/"
  },
  "brokerRole": "https://openactive.io/AgentBroker",
  "customer": {
    "@type": "Person",
    "identifier": "aa23d4ba-7012-46cf-8fdc-ada1811a1dcb",
    "email": "Addison_Reynolds@hotmail.com",
    "familyName": "Aileen",
    "givenName": "Adams",
    "telephone": "721-359-7603 x7149"
  },
  "orderedItem": [
    {
      "@type": "OrderItem",
      "@id": "https://localhost:5001/api/openbooking/orders/58aecb7a-ee2f-4015-9608-a583c76f6aa7#/orderedItems/2555",
      "acceptedOffer": {
        "@type": "Offer",
        "@id": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
        "allowCustomerCancellationFullRefund": false,
        "price": 11.77,
        "priceCurrency": "GBP"
      },
      "accessChannel": {
        "@type": "VirtualLocation",
        "name": "Zoom Video Chat",
        "description": "Please log into Zoom a few minutes before the event",
        "accessCode": "0633455943",
        "accessId": "4597092529"
      },
      "orderedItem": {
        "@type": "ScheduledSession",
        "@id": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332",
        "startDate": "2022-08-01T07:24:11+00:00",
        "endDate": "2022-08-01T10:23:11+00:00",
        "superEvent": {
          "@type": "SessionSeries",
          "@id": "https://localhost:5001/api/identifiers/session-series/1034",
          "name": "Metal Zumba",
          "activity": [
            {
              "@type": "Concept",
              "@id": "https://openactive.io/activity-list#6bdea630-ad22-4e58-98a3-bca26ee3f1da",
              "inScheme": "https://openactive.io/activity-list",
              "prefLabel": "Rave Fitness"
            }
          ],
          "location": {
            "@type": "Place",
            "name": "Fake fitness studio",
            "geo": {
              "@type": "GeoCoordinates",
              "latitude": 51.6201,
              "longitude": 0.302396
            }
          },
          "url": "https://example.com/events/1034"
        },
        "maximumAttendeeCapacity": 3,
        "remainingAttendeeCapacity": 3
      },
      "orderItemStatus": "https://openactive.io/OrderItemConfirmed",
      "unitTaxSpecification": [
        {
          "@type": "TaxChargeSpecification",
          "name": "VAT at 20%",
          "price": 2.354,
          "priceCurrency": "GBP",
          "rate": 0.2
        }
      ]
    }
  ],
  "payment": {
    "@type": "Payment",
    "identifier": "eQcXLVrQN",
    "name": "AcmeBroker Points",
    "accountId": "SN1593",
    "paymentProviderId": "STRIPE"
  },
  "seller": {
    "@type": "Organization",
    "@id": "https://localhost:5001/api/identifiers/sellers/1",
    "name": "Acme Fitness Ltd",
    "address": {
      "@type": "PostalAddress",
      "addressCountry": "GB",
      "addressLocality": "Another town",
      "addressRegion": "Oxfordshire",
      "postalCode": "OX1 1AA",
      "streetAddress": "1 Hidden Gem"
    },
    "isOpenBookingAllowed": true,
    "legalName": "Acme Fitness Ltd",
    "taxMode": "https://openactive.io/TaxGross",
    "termsOfService": [
      {
        "@type": "PrivacyPolicy",
        "name": "Privacy Policy",
        "requiresExplicitConsent": false,
        "url": "https://example.com/privacy.html"
      }
    ]
  },
  "totalPaymentDue": {
    "@type": "PriceSpecification",
    "openBookingPrepayment": "https://openactive.io/Required",
    "price": 11.77,
    "priceCurrency": "GBP"
  },
  "totalPaymentTax": [
    {
      "@type": "TaxChargeSpecification",
      "name": "VAT at 20%",
      "price": 2.354,
      "priceCurrency": "GBP",
      "rate": 0.2
    }
  ]
}
```
### Specs
* ‚úÖ should return 201 on success

## B >> validation of B
### Specs
* ‚úÖ passes validation checks

### Validations
 * ‚ö†Ô∏è $.orderedItem[0].accessCode: Recommended property `accessCode` is missing from `OrderItem`.
 * ‚ö†Ô∏è $.orderedItem[0].accessPass: Recommended property `accessPass` is missing from `OrderItem`.
 * ‚ö†Ô∏è $.orderedItem[0].acceptedOffer.name: Recommended property `name` is missing from `Offer`.
 * ‚ö†Ô∏è $.orderedItem[0].acceptedOffer.ageRestriction: Recommended property `ageRestriction` is missing from `Offer`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.eventStatus: Recommended property `eventStatus` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.ageRange: Recommended property `ageRange` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.genderRestriction: Recommended property `genderRestriction` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.eventStatus: Recommended property `eventStatus` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.id: Recommended property `@id` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.url: Recommended property `url` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.description: Recommended property `description` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.image: Recommended property `image` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.telephone: Recommended property `telephone` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.openingHoursSpecification: Recommended property `openingHoursSpecification` is missing from `Place`.
 * ‚ö†Ô∏è $.orderedItem[0].orderedItem.superEvent.location.amenityFeature: Recommended property `amenityFeature` is missing from `Place`.
 * ‚ö†Ô∏è $.seller.email: Recommended property `email` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.url: Recommended property `url` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.logo: Recommended property `logo` is missing from `Organization`.
 * ‚ö†Ô∏è $.seller.vatID: Recommended property `vatID` is missing from `Organization`.
 * üìù $.orderedItem[0].orderedItem.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `ScheduledSession`.
 * üìù $.orderedItem[0].orderedItem.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.orderedItem[0].orderedItem.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.orderedItem[0].orderedItem.superEvent.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `SessionSeries`.
 * üìù $.orderedItem[0].orderedItem.superEvent.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.orderedItem[0].orderedItem.superEvent.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.

## OrderProposal Feed Deletion (after B)

### Orders (order-proposals) Feed collect for &#x27;58aecb7a-ee2f-4015-9608-a583c76f6aa7&#x27; change (auth: primary) Request
GET http://localhost:3000/order-listeners/order-proposals/primary/58aecb7a-ee2f-4015-9608-a583c76f6aa7


---
Response status code: 200 OK. Responded in 2272.785304ms.
```json
{
  "state": "deleted",
  "kind": "Order",
  "id": "58aecb7a-ee2f-4015-9608-a583c76f6aa7",
  "modified": 637940836844658700
}
```
### Specs
* ‚úÖ should return 200 on success

## OrderProposal Feed Deletion (after B) >> validation of OrderFeed
### Specs
* ‚úÖ passes validation checks

### Validations

## Assert Opportunity Capacity (after OrderProposal Feed Deletion (after B))

### Opportunity Feed extract for OrderItem 0 Request
GET http://localhost:3000/opportunity/https%3A%2F%2Flocalhost%3A5001%2Fapi%2Fidentifiers%2Fscheduled-sessions%2F1034%2Fevents%2F10332?useCacheIfAvailable=true&expectedCapacity=2


---
Response status code: 200 OK. Responded in 11.006784ms.
```json
{
  "data": {
    "@context": [
      "https://openactive.io/",
      "https://openactive.io/ns-beta"
    ],
    "@type": "ScheduledSession",
    "@id": "https://localhost:5001/api/identifiers/scheduled-sessions/1034/events/10332",
    "startDate": "2022-08-01T07:24:11+00:00",
    "endDate": "2022-08-01T10:23:11+00:00",
    "superEvent": {
      "@type": "SessionSeries",
      "@id": "https://localhost:5001/api/identifiers/session-series/1034",
      "name": "Metal Zumba",
      "activity": [
        {
          "@type": "Concept",
          "@id": "https://openactive.io/activity-list#c07d63a0-8eb9-4602-8bcc-23be6deb8f83",
          "inScheme": "https://openactive.io/activity-list",
          "prefLabel": "Jet Skiing"
        }
      ],
      "eventAttendanceMode": "https://schema.org/OnlineEventAttendanceMode",
      "offers": [
        {
          "@type": "Offer",
          "@id": "https://localhost:5001/api/identifiers/session-series/1034#/offers/0",
          "allowCustomerCancellationFullRefund": false,
          "openBookingFlowRequirement": [
            "https://openactive.io/OpenBookingApproval"
          ],
          "price": 11.77,
          "priceCurrency": "GBP"
        }
      ],
      "organizer": {
        "@type": "Organization",
        "@id": "https://localhost:5001/api/identifiers/sellers/1",
        "name": "Acme Fitness Ltd",
        "isOpenBookingAllowed": true,
        "taxMode": "https://openactive.io/TaxGross",
        "termsOfService": [
          {
            "@type": "PrivacyPolicy",
            "name": "Privacy Policy",
            "requiresExplicitConsent": false,
            "url": "https://example.com/privacy.html"
          }
        ]
      },
      "url": "https://www.example.com/a-session-age",
      "beta:affiliatedLocation": {
        "@type": "Place",
        "name": "Fake Pond",
        "address": {
          "@type": "PostalAddress",
          "addressCountry": "GB",
          "addressLocality": "Another town",
          "addressRegion": "Oxfordshire",
          "postalCode": "OX1 1AA",
          "streetAddress": "1 Fake Park"
        },
        "geo": {
          "@type": "GeoCoordinates",
          "latitude": 0,
          "longitude": 0
        }
      }
    },
    "duration": "PT2H59M",
    "maximumAttendeeCapacity": 3,
    "remainingAttendeeCapacity": 2
  }
}
```
### Specs
* ‚úÖ should return 200 on success for request relevant to OrderItem 0
* ‚úÖ should return `totalPaymentDue.openBookingPrepayment` '`https://openactive.io/Required`'
* ‚úÖ should return `totalPaymentDue.openBookingPrepayment` '`https://openactive.io/Required`'

## Assert Opportunity Capacity (after OrderProposal Feed Deletion (after B)) >> validation of Opportunity Feed extract for OrderItem 0
### Specs
* ‚úÖ passes validation checks

### Validations
 * ‚ö†Ô∏è $.eventStatus: Recommended property `eventStatus` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.leader: Recommended property `leader` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.url: Recommended property `url` is missing from `ScheduledSession`.
 * ‚ö†Ô∏è $.superEvent.description: Recommended property `description` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.image: Recommended property `image` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.ageRange: Recommended property `ageRange` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.genderRestriction: Recommended property `genderRestriction` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.leader: Recommended property `leader` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.level: Recommended property `level` is missing from `SessionSeries`.
 * ‚ö†Ô∏è $.superEvent.offers[0].name: Recommended property `name` is missing from `Offer`.
 * ‚ö†Ô∏è $.superEvent.offers[0].ageRestriction: Recommended property `ageRestriction` is missing from `Offer`.
 * ‚ö†Ô∏è $.superEvent.organizer.url: Recommended property `url` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent.organizer.telephone: Recommended property `telephone` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent.organizer.sameAs: Recommended property `sameAs` is missing from `Organization`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].id: Recommended property `@id` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].url: Recommended property `url` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].description: Recommended property `description` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].image: Recommended property `image` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].telephone: Recommended property `telephone` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].openingHoursSpecification: Recommended property `openingHoursSpecification` is missing from `Place`.
 * ‚ö†Ô∏è $.superEvent["beta:affiliatedLocation"].amenityFeature: Recommended property `amenityFeature` is missing from `Place`.
 * üìù $.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `ScheduledSession`.
 * üìù $.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.superEvent.genderRestriction: Data consumers will assume that there is no gender restriction when no valid `genderRestriction` is supplied on a `SessionSeries`.
 * üìù $.superEvent.ageRange: Data consumers will assume that the `ageRange` is 18+ when not specified.
 * üìù $.superEvent.eventStatus: Data consumers will assume the `eventStatus` is scheduled if not specified or invalid.
 * üìù $.superEvent["beta:affiliatedLocation"].geo.latitude: The value of this property should have at least 3 decimal places. Note that this notice will also appear when trailing zeros have been truncated.
 * üìù $.superEvent["beta:affiliatedLocation"].geo.longitude: The value of this property should have at least 3 decimal places. Note that this notice will also appear when trailing zeros have been truncated.


